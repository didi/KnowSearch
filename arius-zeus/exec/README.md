# exec

## 设计思路

N个集群的海量agent直接连接scheduler模块，对scheduler模块压力太大，在各个地域分别放置一些exec模块，作为中间代理，缓存一部分数据（主要是任务元信息，这个数据是不会发生变化的，适合放内存），agent先与exec通信，exec再与scheduler通信，减小scheduler的压力。

agent定期（每2秒）与exec通信，汇报哪些任务执行完了，询问还有哪些任务要执行。agent心跳上来的任务，都是状态发生变化的，exec拿到之后，直接告诉scheduler，scheduler更新数据库，同时scheduler查看该机器还有哪些任务要跑，一并返回。exec就是一个通道，逻辑简单清晰，没有状态。但是这样一来，会频繁与scheduler通信，当然，每次通信的内容比较少。另一种做法，是exec一次性拉取所有待执行的机器和任务信息，这样与scheduler通信次数减少，但是内容增多。从网络层面来讲，我们更喜欢细水长流型的，而不是有波峰波谷型的，故而，就拿exec当一个通道就好。
